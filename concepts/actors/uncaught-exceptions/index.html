<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://microsoft.github.io/coyote/concepts/actors/uncaught-exceptions/">
    <link rel="shortcut icon" href="/coyote/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Semantics of unhandled exceptions - Coyote</title>
    <link href="/coyote/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/coyote/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/coyote/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/coyote/css/highlight.css">
    <link href="../../../css/main.css" rel="stylesheet">
    <link href="../../../css/player-controls.css" rel="stylesheet">
    <link href="../../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/coyote/js/jquery-3.2.1.min.js"></script>
    <script src="/coyote/js/bootstrap-3.3.7.min.js"></script>
    <script src="/coyote/js/highlight.pack.js"></script>
    <script src="https://consentdeliveryfd.azurefd.net/mscc/lib/v2/wcp-consent.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '/coyote/';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Semantics of unhandled exceptions", url: "#_top", children: [
          ]},
          {title: "Call Stack and debugging", url: "#call-stack-and-debugging", children: [
          ]},
        ];

    </script>
    <script src="/coyote/js/base.js"></script>
      <script src="../../../assets/js/analytics.js"></script>
      <script src="../../../assets/js/plugins.js"></script>
      <script src="../../../assets/js/animate_trace.js"></script>
      <script src="../../../assets/js/animation.js"></script>
      <script src="../../../assets/js/progress_bar.js"></script>
      <script src="../../../assets/js/trace_model.js"></script>
      <script src="../../../assets/js/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../sharing-objects/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../sharing-objects/" class="btn btn-xs btn-link">
        Sharing objects
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../event-groups/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../event-groups/" class="btn btn-xs btn-link">
        Event groups
      </a>
    </div>
    
  </div>

      

      <h2 id="semantics-of-unhandled-exceptions">Semantics of unhandled exceptions</h2>
<p>Coyote <code>Actors</code> can execute arbitrary C# code in their event handlers. This page discusses what
happens if such code throws an exception that is not handled inside the action itself. As is usual
in <a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/exception-handling-task-parallel-library">asynchronous
programming</a>,
one should be careful with unhandled exceptions.</p>
<p>In test mode (i.e., when running a test with <code>coyote test ...</code>), all unhandled exceptions are an
error and the test will fail. The <code>coyote</code> tester will stop the execution at that point and report
an error.</p>
<p>In production mode (i.e., when running a Coyote program outside of <code>coyote test</code>), the Coyote
runtime intercepts any unhandled exception in an actor. The exception is then delivered to the
<code>OnFailure</code> delegate of the runtime. At this point, it is your responsibility to take the
appropriate action. For instance, you can cause the program to crash and create a dump (for
debugging later) as follows:</p>
<pre><code class="language-csharp">runtime.OnFailure += delegate (Exception exception)
{
   Environment.FailFast(exception.ToString(), exception);
};
</code></pre>
<p>It is important that you induce a crash to stop the program, after perhaps taking some cleanup
actions. If you don&rsquo;t do so, the runtime automatically enters a &ldquo;failure&rdquo; mode. Actors may continue
running their current action, but no additional work will take place. The runtime stops all
<code>Enqueue</code> and <code>Dequeue</code> operations in the program. Thus, messages sent will not be delivered, and
already-received messages will not be dequeued. If you wish to suppress an exception and have the
rest of the program continue normal operation, then it is best to catch the exception in the action
itself using a usual <code>try { } catch { }</code> block, or override the actor&rsquo;s <code>OnException</code> method to
handle exceptions in one place.  This override can return one of the following outcomes:</p>
<pre><code class="language-csharp">// The outcome when an Microsoft.Coyote.Actors.Actor throws an exception.
public enum OnExceptionOutcome
{
   // The actor throws the exception causing the runtime to fail.
   ThrowException = 0,

   // The actor handles the exception and resumes execution.
   HandledException = 1,

   // The actor handles the exception and halts.
   Halt = 2
}
</code></pre>
<h2 id="call-stack-and-debugging">Call Stack and debugging</h2>
<p>The runtime tries to call the <code>OnFailure</code> delegate with the stack intact. That is, if you launch a
debugger from inside the <code>OnFailure</code> method, you will see the stack (with local variables) at the
point the exception was thrown. However, this is not always the case. If the exception was thrown
from an <code>async</code> action, then the stack may have gotten unwound even before the runtime gets to know
of the exception (because of the way <code>async</code> continuations get compiled).</p>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../sharing-objects/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../sharing-objects/" class="btn btn-xs btn-link">
        Sharing objects
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../event-groups/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../event-groups/" class="btn btn-xs btn-link">
        Event groups
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">
  

<section class="footer-join pt-40 pb-80">
  <div class="container-fluid">
    <div class="row text-center">
      <div class="col-sm-8 col-sm-offset-2">
      </div>
    </div>
    <div class="row">
   </div>
  </div>
</section>
<section class="footer-dark pt-60">
  <div class="container-fluid">
    <div class="row">
      <div class="hidden-xs col-sm-5 col-lg-6">
        <a href="" title="homepage" class="logo-footer">
          <img src="/coyote/assets/images/icon.png" alt="Coyote">
        </a>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Coyote</h4>
          <ul class="list-unstyled">
            <li><a href="/coyote/">Home</a></li>
            <li><a href="/coyote/get-started/install/">Install</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Resources</h4>
          <ul class="list-unstyled">
            <li><a href="/coyote/tutorials/first-concurrency-unit-test/">Getting started</a></li>
            <li><a href="/coyote/tutorials/overview/">Tutorials</a></li>
            <li><a href="/coyote/ref/Microsoft.Coyote">API documentation</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Community</h4>
          <ul class="list-unstyled">
            <li><a href="https://github.com/microsoft/coyote/"><i class="fa fa-github"></i>
GitHub</a></li>
            <li><a href="https://twitter.com/coyote_dev" target="_blank"><i class="fa fa-twitter"></i> Twitter</a></li>
            <li><a href="https://gitter.im/microsoft/coyote" target="_blank">Gitter</a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="row footnote pt-50 pb-20">
      <div class="col-sm-12">
        <hr>
      </div>
      <div class="col-sm-6">
        <ul class="list-unstyled list-inline footnote-copy">
          <li><a href="https://privacy.microsoft.com/en-us/privacystatement/" target="_blank">Privacy</a></li>
          <li><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/copyright/default.aspx" target="_blank">Terms of Use</a></li>
          <li><a href="https://github.com/microsoft/coyote/blob/main/LICENSE" target="_blank">License</a></li>
          <li><a href="javascript:manageCookies()">Cookies</a></li>
        </ul>
      </div>
      <div class="col-sm-6 text-right footnote-copy">
        <ul class="list-unstyled list-inline">
          <li><span id="copyright"></span></li>
          <li><a href="https://www.microsoft.com/" target="_blank"><img class="img-responsive" src="/coyote/assets/images/microsoft-logo.svg?v=3" alt="Microsoft">&nbsp;</a></li>
        </ul>
      </div>
    </div>
  </div>
</section>
</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>